<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹•è©ä¸‰æ…‹äº’å‹•å­¸ç¿’ç¶²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                        display: ['"Fredoka"', 'cursive'],
                    },
                    colors: {
                        'brand-blue': '#4facfe',
                        'brand-purple': '#00f2fe',
                        'game-bg': '#f3f4f6',
                    },
                    animation: {
                        'glow-pulse': 'glowPulse 1.5s infinite',
                    },
                    keyframes: {
                        glowPulse: {
                            '0%, 100%': { boxShadow: '0 0 0 0 rgba(250, 204, 21, 0.7)' },
                            '50%': { boxShadow: '0 0 0 10px rgba(250, 204, 21, 0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .btn-3d {
            transition: all 0.1s;
            transform: translateY(0);
            border-bottom-width: 4px;
        }
        .btn-3d:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
            margin-top: 2px;
        }

        .blob {
            position: absolute;
            filter: blur(80px);
            z-index: -1;
            animation: float 10s infinite ease-in-out alternate;
        }
        .blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: rgba(255, 154, 158, 0.4); animation-delay: 0s; }
        .blob-2 { bottom: -10%; right: -10%; width: 400px; height: 400px; background: rgba(161, 140, 209, 0.4); animation-delay: -5s; }
        .blob-3 { top: 40%; left: 40%; width: 300px; height: 300px; background: rgba(251, 194, 235, 0.3); animation-delay: -2s; }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(30px, 50px) scale(1.1); }
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .table-row-hover:hover {
            background-color: #f0f9ff;
            transform: scale(1.01);
            transition: all 0.2s;
        }

        .speaker-icon {
            cursor: pointer;
            color: #6366f1;
            transition: all 0.2s;
        }
        .speaker-icon:hover {
            color: #4338ca;
            transform: scale(1.2);
        }
        .speaker-icon.active {
            color: #ec4899;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .hidden-section { display: none !important; }

        .bounce-in { animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        
        .fade-in-up { animation: fadeInUp 0.5s ease-out; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="text-slate-700 antialiased selection:bg-purple-200 selection:text-purple-900">

    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>

    <div class="container mx-auto px-4 py-8 max-w-6xl relative z-10">
        
        <header class="text-center mb-10 fade-in-up">
            <h1 class="text-4xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 tracking-tight font-display drop-shadow-sm mb-4">
                å‹•è©ä¸‰æ…‹å¤§æŒ‘æˆ°
            </h1>
            <p class="text-lg md:text-xl text-slate-600 font-medium bg-white/60 inline-block px-6 py-2 rounded-full shadow-sm backdrop-blur-sm">
                ğŸ§ é»æ“Šå–‡å­è½ç™¼éŸ³ Â· ğŸš€ åˆ‡æ›åˆ†é ä¾†é—–é—œ
            </p>
        </header>

        <div class="flex justify-center mb-10 fade-in-up" style="animation-delay: 0.1s;">
            <div class="bg-white/80 p-2 rounded-2xl shadow-lg backdrop-blur flex gap-2">
                <button id="tab-study" class="px-8 py-3 rounded-xl font-bold text-lg transition-all duration-300 flex items-center gap-2 bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white shadow-md transform scale-105">
                    <span>ğŸ“–</span> å–®å­—è¡¨å­¸ç¿’
                </button>
                <button id="tab-quiz" class="px-8 py-3 rounded-xl font-bold text-lg transition-all duration-300 flex items-center gap-2 text-slate-500 hover:bg-slate-100">
                    <span>ğŸ®</span> éš¨æ©Ÿæ¸¬é©—
                </button>
            </div>
        </div>

        <div id="study-view" class="fade-in-up" style="animation-delay: 0.2s;">
            <main id="verb-tables" class="space-y-10">
                <!-- JS Generated -->
            </main>
        </div>

        <div id="quiz-view" class="hidden-section fade-in-up">
            <section class="max-w-4xl mx-auto">
                
                <div class="glass-panel rounded-3xl shadow-2xl overflow-hidden min-h-[500px] flex flex-col relative">
                    
                    <div class="h-3 bg-gradient-to-r from-yellow-400 via-red-500 to-pink-500 w-full"></div>

                    <!-- Lobby -->
                    <div id="quiz-lobby" class="flex-1 flex flex-col items-center justify-center p-8 text-center bounce-in">
                        <div class="text-8xl mb-6 animate-bounce">ğŸš€</div>
                        <h2 class="text-3xl md:text-4xl font-black text-slate-800 mb-4">æº–å‚™å¥½æ¥å—æŒ‘æˆ°äº†å—ï¼Ÿ</h2>
                        <p class="text-xl text-slate-600 mb-10 max-w-md">ç³»çµ±å°‡æœƒéš¨æ©Ÿå‡ºé¡Œï¼Œæ¸¬è©¦ä½ å°å‹•è©ä¸‰æ…‹çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼</p>
                        
                        <div class="mb-10 bg-white/50 p-6 rounded-2xl border border-white shadow-inner w-full max-w-2xl">
                            <h3 class="text-lg font-bold text-slate-700 mb-4 flex items-center justify-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                                é¸æ“‡æ¸¬é©—ç¯„åœ
                                <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                            </h3>
                            <div id="category-selector" class="flex flex-wrap justify-center gap-3">
                                <!-- JS Generated -->
                            </div>
                        </div>

                        <button id="start-game-btn" class="btn-3d px-12 py-5 bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-black text-2xl rounded-2xl shadow-xl border-blue-600 hover:brightness-110 active:scale-95 flex items-center gap-3">
                            é–‹å§‹æŒ‘æˆ° GO!
                        </button>
                    </div>

                    <!-- Interface -->
                    <div id="quiz-interface" class="hidden-section flex-1 flex flex-col p-6 md:p-10">
                        
                        <!-- HUD -->
                        <div class="flex justify-between items-center mb-8">
                            <button id="back-to-lobby-btn" class="text-sm font-bold text-slate-400 hover:text-slate-600 flex items-center gap-1 transition-colors">
                                â† å›åˆ°è¨­å®š
                            </button>
                            <div class="flex gap-4">
                                <div class="bg-white px-4 py-2 rounded-xl shadow-sm border border-slate-100 flex flex-col items-center min-w-[100px]">
                                    <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Score</span>
                                    <span id="score" class="text-2xl font-black text-blue-600 leading-none">0</span>
                                </div>
                                <!-- ä¸Šæ–¹é€£å°è¨ˆæ•¸å™¨ä¿ç•™ï¼Œä½†ä¸‹é¢æœƒåŠ æ–°çš„ -->
                                <div class="bg-white px-4 py-2 rounded-xl shadow-sm border border-slate-100 flex flex-col items-center min-w-[100px]">
                                    <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Streak</span>
                                    <span id="streak" class="text-2xl font-black text-orange-500 leading-none">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Question Area -->
                        <div class="flex-1 flex flex-col items-center justify-center max-w-3xl mx-auto w-full">
                            
                            <div class="w-full bg-gradient-to-br from-indigo-600 to-purple-700 text-white rounded-2xl p-8 md:p-12 shadow-xl mb-8 text-center relative overflow-hidden group">
                                <div class="absolute top-0 right-0 p-4 opacity-10 text-9xl font-display select-none pointer-events-none group-hover:scale-110 transition-transform">?</div>
                                <p id="question-text" class="text-2xl md:text-4xl font-bold leading-relaxed relative z-10">
                                    Loading...
                                </p>
                            </div>

                            <div class="w-full space-y-4">
                                <input type="text" id="answer-input" autocomplete="off" placeholder="è«‹åœ¨æ­¤è¼¸å…¥è‹±æ–‡ç­”æ¡ˆ..." class="w-full text-center text-2xl md:text-3xl font-bold py-5 px-6 rounded-2xl border-4 border-slate-200 focus:border-purple-400 focus:ring-4 focus:ring-purple-100 outline-none transition-all placeholder:text-slate-300 bg-white shadow-inner text-slate-700">
                                
                                <!-- æŒ‰éˆ•å€åŸŸ -->
                                <div class="h-24 w-full relative flex gap-3">
                                    <!-- é€å‡ºæŒ‰éˆ• (ä½”æ»¿å…¨å¯¬) -->
                                    <button id="submit-btn" class="btn-3d w-full h-20 bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-bold text-xl md:text-2xl rounded-2xl shadow-lg border-emerald-600 hover:brightness-110 active:scale-95 transition-all">
                                        é€å‡ºç­”æ¡ˆ (Enter)
                                    </button>
                                    
                                    <!-- ä¸‹ä¸€é¡ŒæŒ‰éˆ•èˆ‡é€£å°é¡¯ç¤ºå®¹å™¨ (éš±è—æ™‚ç”¨ hidden-section) -->
                                    <div id="next-action-container" class="hidden-section w-full h-20 flex gap-3">
                                        <!-- é€£å°é¡¯ç¤º (ä½” 1/3) -->
                                        <div class="w-1/3 h-full bg-orange-100 rounded-2xl border-4 border-orange-200 flex flex-col items-center justify-center shadow-inner">
                                            <span class="text-xs font-bold text-orange-400 uppercase">é€£å° Streak</span>
                                            <div id="local-streak" class="text-3xl font-black text-orange-500 flex items-center gap-1">
                                                ğŸ”¥ x0
                                            </div>
                                        </div>

                                        <!-- ä¸‹ä¸€é¡ŒæŒ‰éˆ• (ä½” 2/3) -->
                                        <button id="next-question-btn" class="btn-3d flex-1 h-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold text-xl md:text-2xl rounded-2xl shadow-lg border-yellow-600 hover:brightness-110 active:scale-95 transition-all flex items-center justify-center gap-2 animate-glow-pulse">
                                            ä¸‹ä¸€é¡Œ (Enter) <span>â”</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div id="feedback-container" class="mt-4 h-16 flex items-center justify-center text-xl md:text-2xl font-bold transition-all opacity-0">
                                <!-- Feedback -->
                            </div>

                        </div>
                    </div>

                </div>
            </section>
        </div>

    </div>

    <script>
        const verbData = [
            {
                title: "1. è¦å‰‡å‹•è© (Regular)",
                verbs: [
                    { infinitive: 'ask', pastSimple: 'asked', pastParticiple: 'asked', presentParticiple: 'asking', translation: 'å•' },
                    { infinitive: 'learn', pastSimple: 'learned', pastParticiple: 'learned', presentParticiple: 'learning', translation: 'å­¸ç¿’' },
                    { infinitive: 'start', pastSimple: 'started', pastParticiple: 'started', presentParticiple: 'starting', translation: 'é–‹å§‹' },
                    { infinitive: 'play', pastSimple: 'played', pastParticiple: 'played', presentParticiple: 'playing', translation: 'ç©' },
                    { infinitive: 'die', pastSimple: 'died', pastParticiple: 'died', presentParticiple: 'dying', translation: 'æ­»äº¡' },
                    { infinitive: 'close', pastSimple: 'closed', pastParticiple: 'closed', presentParticiple: 'closing', translation: 'é—œé–‰' },
                    { infinitive: 'like', pastSimple: 'liked', pastParticiple: 'liked', presentParticiple: 'liking', translation: 'å–œæ­¡' },
                    { infinitive: 'hope', pastSimple: 'hoped', pastParticiple: 'hoped', presentParticiple: 'hoping', translation: 'å¸Œæœ›' }
                ]
            },
            {
                title: "2. A-A-A å‹ (åŒå½¢)",
                verbs: [
                    { infinitive: 'cost', pastSimple: 'cost', pastParticiple: 'cost', presentParticiple: 'costing', translation: 'èŠ±è²»' },
                    { infinitive: 'cut', pastSimple: 'cut', pastParticiple: 'cut', presentParticiple: 'cutting', translation: 'å‰²' },
                    { infinitive: 'hit', pastSimple: 'hit', pastParticiple: 'hit', presentParticiple: 'hitting', translation: 'æ‰“' },
                    { infinitive: 'let', pastSimple: 'let', pastParticiple: 'let', presentParticiple: 'letting', translation: 'å…è¨±' },
                    { infinitive: 'put', pastSimple: 'put', pastParticiple: 'put', presentParticiple: 'putting', translation: 'æ”¾ç½®' },
                    { infinitive: 'read', pastSimple: 'read', pastParticiple: 'read', presentParticiple: 'reading', translation: 'é–±è®€' },
                    { infinitive: 'set', pastSimple: 'set', pastParticiple: 'set', presentParticiple: 'setting', translation: 'è¨­ç½®' },
                    { infinitive: 'spread', pastSimple: 'spread', pastParticiple: 'spread', presentParticiple: 'spreading', translation: 'å±•é–‹' },
                    { infinitive: 'fit', pastSimple: 'fit', pastParticiple: 'fit', presentParticiple: 'fitting', translation: 'åˆèº«' },
                    { infinitive: 'hurt', pastSimple: 'hurt', pastParticiple: 'hurt', presentParticiple: 'hurting', translation: 'å‚·å®³' },
                    { infinitive: 'quit', pastSimple: 'quit', pastParticiple: 'quit', presentParticiple: 'quitting', translation: 'æ”¾æ£„' },
                    { infinitive: 'shut', pastSimple: 'shut', pastParticiple: 'shut', presentParticiple: 'shutting', translation: 'é—œé–‰' }
                ]
            },
            {
                title: "3. A-B-B å‹ (äºŒæ…‹åŒ)",
                verbs: [
                    { infinitive: 'buy', pastSimple: 'bought', pastParticiple: 'bought', presentParticiple: 'buying', translation: 'è³¼è²·' },
                    { infinitive: 'sell', pastSimple: 'sold', pastParticiple: 'sold', presentParticiple: 'selling', translation: 'è²©è³£' },
                    { infinitive: 'hold', pastSimple: 'held', pastParticiple: 'held', presentParticiple: 'holding', translation: 'æ¡ä½' },
                    { infinitive: 'tell', pastSimple: 'told', pastParticiple: 'told', presentParticiple: 'telling', translation: 'å‘Šè¨´' },
                    { infinitive: 'think', pastSimple: 'thought', pastParticiple: 'thought', presentParticiple: 'thinking', translation: 'æ€è€ƒ' },
                    { infinitive: 'bring', pastSimple: 'brought', pastParticiple: 'brought', presentParticiple: 'bringing', translation: 'å¸¶ä¾†' },
                    { infinitive: 'meet', pastSimple: 'met', pastParticiple: 'met', presentParticiple: 'meeting', translation: 'é‡è¦‹' },
                    { infinitive: 'keep', pastSimple: 'kept', pastParticiple: 'kept', presentParticiple: 'keeping', translation: 'ä¿æŒ' },
                    { infinitive: 'sleep', pastSimple: 'slept', pastParticiple: 'slept', presentParticiple: 'sleeping', translation: 'ç¡è¦º' },
                    { infinitive: 'find', pastSimple: 'found', pastParticiple: 'found', presentParticiple: 'finding', translation: 'ç™¼ç¾' },
                    { infinitive: 'seek', pastSimple: 'sought', pastParticiple: 'sought', presentParticiple: 'seeking', translation: 'å°‹æ‰¾' },
                    { infinitive: 'teach', pastSimple: 'taught', pastParticiple: 'taught', presentParticiple: 'teaching', translation: 'æ•™' },
                    { infinitive: 'spend', pastSimple: 'spent', pastParticiple: 'spent', presentParticiple: 'spending', translation: 'èŠ±è²»' },
                    { infinitive: 'send', pastSimple: 'sent', pastParticiple: 'sent', presentParticiple: 'sending', translation: 'å¯„é€' },
                    { infinitive: 'stand', pastSimple: 'stood', pastParticiple: 'stood', presentParticiple: 'standing', translation: 'ç«™ç«‹' },
                    { infinitive: 'feel', pastSimple: 'felt', pastParticiple: 'felt', presentParticiple: 'feeling', translation: 'æ„Ÿè¦º' },
                    { infinitive: 'catch', pastSimple: 'caught', pastParticiple: 'caught', presentParticiple: 'catching', translation: 'æ•æŠ“' },
                    { infinitive: 'hear', pastSimple: 'heard', pastParticiple: 'heard', presentParticiple: 'hearing', translation: 'è½è¦‹' },
                    { infinitive: 'build', pastSimple: 'built', pastParticiple: 'built', presentParticiple: 'building', translation: 'èˆˆå»º' },
                    { infinitive: 'bend', pastSimple: 'bent', pastParticiple: 'bent', presentParticiple: 'bending', translation: 'å½æ›²' },
                    { infinitive: 'burn', pastSimple: 'burnt', pastParticiple: 'burnt', presentParticiple: 'burning', translation: 'ç‡ƒç‡’' },
                    { infinitive: 'deal', pastSimple: 'dealt', pastParticiple: 'dealt', presentParticiple: 'dealing', translation: 'è™•ç†' },
                    { infinitive: 'dig', pastSimple: 'dug', pastParticiple: 'dug', presentParticiple: 'digging', translation: 'æŒ–' },
                    { infinitive: 'dive', pastSimple: 'dove', pastParticiple: 'dove', presentParticiple: 'diving', translation: 'æ½›æ°´' },
                    { infinitive: 'feed', pastSimple: 'fed', pastParticiple: 'fed', presentParticiple: 'feeding', translation: 'é¤µ' },
                    { infinitive: 'fight', pastSimple: 'fought', pastParticiple: 'fought', presentParticiple: 'fighting', translation: 'æ‰“æ¶' },
                    { infinitive: 'get', pastSimple: 'got', pastParticiple: 'got', presentParticiple: 'getting', translation: 'å¾—åˆ°' },
                    { infinitive: 'hang', pastSimple: 'hung', pastParticiple: 'hung', presentParticiple: 'hanging', translation: 'æ‡¸æ›' },
                    { infinitive: 'have', pastSimple: 'had', pastParticiple: 'had', presentParticiple: 'having', translation: 'æœ‰;åƒ' },
                    { infinitive: 'lead', pastSimple: 'led', pastParticiple: 'led', presentParticiple: 'leading', translation: 'é ˜å°' },
                    { infinitive: 'leave', pastSimple: 'left', pastParticiple: 'left', presentParticiple: 'leaving', translation: 'é›¢é–‹' },
                    { infinitive: 'lend', pastSimple: 'lent', pastParticiple: 'lent', presentParticiple: 'lending', translation: 'å€Ÿå‡º' },
                    { infinitive: 'light', pastSimple: 'lit', pastParticiple: 'lit', presentParticiple: 'lighting', translation: 'é»ç‡ƒ' },
                    { infinitive: 'lose', pastSimple: 'lost', pastParticiple: 'lost', presentParticiple: 'losing', translation: 'å¤±å»' },
                    { infinitive: 'make', pastSimple: 'made', pastParticiple: 'made', presentParticiple: 'making', translation: 'è£½ä½œ' },
                    { infinitive: 'mean', pastSimple: 'meant', pastParticiple: 'meant', presentParticiple: 'meaning', translation: 'æ„æŒ‡' },
                    { infinitive: 'pay', pastSimple: 'paid', pastParticiple: 'paid', presentParticiple: 'paying', translation: 'ä»˜è²»' },
                    { infinitive: 'say', pastSimple: 'said', pastParticiple: 'said', presentParticiple: 'saying', translation: 'èªª' },
                    { infinitive: 'shine', pastSimple: 'shone', pastParticiple: 'shone', presentParticiple: 'shining', translation: 'ç…§è€€' },
                    { infinitive: 'shoot', pastSimple: 'shot', pastParticiple: 'shot', presentParticiple: 'shooting', translation: 'å°„æ“Š' },
                    { infinitive: 'sit', pastSimple: 'sat', pastParticiple: 'sat', presentParticiple: 'sitting', translation: 'å' },
                    { infinitive: 'smell', pastSimple: 'smelt', pastParticiple: 'smelt', presentParticiple: 'smelling', translation: 'è' },
                    { infinitive: 'spell', pastSimple: 'spelt', pastParticiple: 'spelt', presentParticiple: 'spelling', translation: 'æ‹¼å­—' },
                    { infinitive: 'stick', pastSimple: 'stuck', pastParticiple: 'stuck', presentParticiple: 'sticking', translation: 'é»' },
                    { infinitive: 'sweep', pastSimple: 'swept', pastParticiple: 'swept', presentParticiple: 'sweeping', translation: 'æ¸…æƒ' },
                    { infinitive: 'understand', pastSimple: 'understood', pastParticiple: 'understood', presentParticiple: 'understanding', translation: 'äº†è§£' },
                    { infinitive: 'win', pastSimple: 'won', pastParticiple: 'won', presentParticiple: 'winning', translation: 'è´' }
                ]
            },
            {
                title: "4. A-B-C å‹ (å…¨ç•°)",
                verbs: [
                    { infinitive: 'ride', pastSimple: 'rode', pastParticiple: 'ridden', presentParticiple: 'riding', translation: 'é¨' },
                    { infinitive: 'drive', pastSimple: 'drove', pastParticiple: 'driven', presentParticiple: 'driving', translation: 'é–‹è»Š' },
                    { infinitive: 'shake', pastSimple: 'shook', pastParticiple: 'shaken', presentParticiple: 'shaking', translation: 'éœ‡å‹•' },
                    { infinitive: 'choose', pastSimple: 'chose', pastParticiple: 'chosen', presentParticiple: 'choosing', translation: 'é¸æ“‡' },
                    { infinitive: 'break', pastSimple: 'broke', pastParticiple: 'broken', presentParticiple: 'breaking', translation: 'æ‰“ç ´' },
                    { infinitive: 'speak', pastSimple: 'spoke', pastParticiple: 'spoken', presentParticiple: 'speaking', translation: 'èªªè©±' },
                    { infinitive: 'write', pastSimple: 'wrote', pastParticiple: 'written', presentParticiple: 'writing', translation: 'å¯«' },
                    { infinitive: 'eat', pastSimple: 'ate', pastParticiple: 'eaten', presentParticiple: 'eating', translation: 'åƒ' },
                    { infinitive: 'fall', pastSimple: 'fell', pastParticiple: 'fallen', presentParticiple: 'falling', translation: 'è½ä¸‹' },
                    { infinitive: 'forget', pastSimple: 'forgot', pastParticiple: 'forgotten', presentParticiple: 'forgetting', translation: 'å¿˜è¨˜' },
                    { infinitive: 'begin', pastSimple: 'began', pastParticiple: 'begun', presentParticiple: 'beginning', translation: 'é–‹å§‹' },
                    { infinitive: 'drink', pastSimple: 'drank', pastParticiple: 'drunk', presentParticiple: 'drinking', translation: 'å–' },
                    { infinitive: 'know', pastSimple: 'knew', pastParticiple: 'known', presentParticiple: 'knowing', translation: 'çŸ¥é“' },
                    { infinitive: 'fly', pastSimple: 'flew', pastParticiple: 'flown', presentParticiple: 'flying', translation: 'é£›' },
                    { infinitive: 'go', pastSimple: 'went', pastParticiple: 'gone', presentParticiple: 'going', translation: 'å»' },
                    { infinitive: 'see', pastSimple: 'saw', pastParticiple: 'seen', presentParticiple: 'seeing', translation: 'çœ‹è¦‹' },
                    { infinitive: 'grow', pastSimple: 'grew', pastParticiple: 'grown', presentParticiple: 'growing', translation: 'ç”Ÿé•·' },
                    { infinitive: 'swim', pastSimple: 'swam', pastParticiple: 'swum', presentParticiple: 'swimming', translation: 'æ¸¸æ³³' },
                    { infinitive: 'do', pastSimple: 'did', pastParticiple: 'done', presentParticiple: 'doing', translation: 'åš' },
                    { infinitive: 'be', pastSimple: 'was/were', pastParticiple: 'been', presentParticiple: 'being', translation: 'æ˜¯' },
                    { infinitive: 'bear', pastSimple: 'bore', pastParticiple: 'born', presentParticiple: 'bearing', translation: 'ç”Ÿ' },
                    { infinitive: 'beat', pastSimple: 'beat', pastParticiple: 'beaten', presentParticiple: 'beating', translation: 'æ‰“æ•—' },
                    { infinitive: 'bite', pastSimple: 'bit', pastParticiple: 'bitten', presentParticiple: 'biting', translation: 'å’¬' },
                    { infinitive: 'blow', pastSimple: 'blew', pastParticiple: 'blown', presentParticiple: 'blowing', translation: 'å¹' },
                    { infinitive: 'draw', pastSimple: 'drew', pastParticiple: 'drawn', presentParticiple: 'drawing', translation: 'ç•«' },
                    { infinitive: 'forgive', pastSimple: 'forgave', pastParticiple: 'forgiven', presentParticiple: 'forgiving', translation: 'åŸè«’' },
                    { infinitive: 'freeze', pastSimple: 'froze', pastParticiple: 'frozen', presentParticiple: 'freezing', translation: 'å‡çµ' },
                    { infinitive: 'get', pastSimple: 'got', pastParticiple: 'gotten', presentParticiple: 'getting', translation: 'ç²å¾—' },
                    { infinitive: 'give', pastSimple: 'gave', pastParticiple: 'given', presentParticiple: 'giving', translation: 'çµ¦' },
                    { infinitive: 'hide', pastSimple: 'hid', pastParticiple: 'hidden', presentParticiple: 'hiding', translation: 'èº²è—' },
                    { infinitive: 'lie', pastSimple: 'lay', pastParticiple: 'lain', presentParticiple: 'lying', translation: 'èºº' },
                    { infinitive: 'ring', pastSimple: 'rang', pastParticiple: 'rung', presentParticiple: 'ringing', translation: 'éˆ´éŸ¿' },
                    { infinitive: 'rise', pastSimple: 'rose', pastParticiple: 'risen', presentParticiple: 'rising', translation: 'ä¸Šå‡' },
                    { infinitive: 'show', pastSimple: 'showed', pastParticiple: 'shown', presentParticiple: 'showing', translation: 'å±•ç¤º' },
                    { infinitive: 'sing', pastSimple: 'sang', pastParticiple: 'sung', presentParticiple: 'singing', translation: 'å”±' },
                    { infinitive: 'steal', pastSimple: 'stole', pastParticiple: 'stolen', presentParticiple: 'stealing', translation: 'å·' },
                    { infinitive: 'take', pastSimple: 'took', pastParticiple: 'taken', presentParticiple: 'taking', translation: 'æ‹¿' },
                    { infinitive: 'throw', pastSimple: 'threw', pastParticiple: 'thrown', presentParticiple: 'throwing', translation: 'ä¸Ÿ' },
                    { infinitive: 'wake', pastSimple: 'woke', pastParticiple: 'woken', presentParticiple: 'waking', translation: 'é†’ä¾†' },
                    { infinitive: 'wear', pastSimple: 'wore', pastParticiple: 'worn', presentParticiple: 'wearing', translation: 'ç©¿' },
                    { infinitive: 'write', pastSimple: 'wrote', pastParticiple: 'written', presentParticiple: 'writing', translation: 'å¯«' }
                ]
            },
            {
                title: "5. A-B-A å‹ (è¿´æ—‹)",
                verbs: [
                    { infinitive: 'run', pastSimple: 'ran', pastParticiple: 'run', presentParticiple: 'running', translation: 'è·‘' },
                    { infinitive: 'come', pastSimple: 'came', pastParticiple: 'come', presentParticiple: 'coming', translation: 'ä¾†' },
                    { infinitive: 'become', pastSimple: 'became', pastParticiple: 'become', presentParticiple: 'becoming', translation: 'è®Šæˆ' },
                    { infinitive: 'overcome', pastSimple: 'overcame', pastParticiple: 'overcome', presentParticiple: 'overcoming', translation: 'å…‹æœ' }
                ]
            }
        ];

        let currentQuestion = null;
        let score = 0;
        let streak = 0;
        let isQuestionAnswered = false;
        
        // DOM Elements
        const verbTablesContainer = document.getElementById('verb-tables');
        const questionText = document.getElementById('question-text');
        const answerInput = document.getElementById('answer-input');
        const submitBtn = document.getElementById('submit-btn');
        const nextActionContainer = document.getElementById('next-action-container');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const localStreakEl = document.getElementById('local-streak');
        
        const feedbackContainer = document.getElementById('feedback-container');
        const scoreEl = document.getElementById('score');
        const streakEl = document.getElementById('streak');
        const categorySelectorEl = document.getElementById('category-selector');
        
        const quizLobby = document.getElementById('quiz-lobby');
        const quizInterface = document.getElementById('quiz-interface');
        const startGameBtn = document.getElementById('start-game-btn');
        const backToLobbyBtn = document.getElementById('back-to-lobby-btn');

        // Tabs
        const tabStudy = document.getElementById('tab-study');
        const tabQuiz = document.getElementById('tab-quiz');
        const studyView = document.getElementById('study-view');
        const quizView = document.getElementById('quiz-view');

        // Voice
        let selectedVoice = null;

        function loadVoices() {
            const voices = speechSynthesis.getVoices();
            selectedVoice = voices.find(voice => voice.name === 'Google US English' && voice.lang === 'en-US');
            
            if (!selectedVoice) {
                selectedVoice = voices.find(voice => 
                    voice.lang === 'en-US' && 
                    (voice.name.includes('Female') || voice.name.includes('Samantha') || voice.name.includes('Fiona'))
                );
            }
            if (!selectedVoice) {
                 selectedVoice = voices.find(voice => voice.lang === 'en-US');
            }
        }

        function speak(texts, iconElement = null) {
            if (!('speechSynthesis' in window)) return;
            
            const wordsToSpeak = Array.isArray(texts) ? texts : [texts];
            if (wordsToSpeak.length === 0) return;

            speechSynthesis.cancel(); 
            document.querySelectorAll('.speaker-icon.active').forEach(icon => {
                icon.classList.remove('active');
            });

            if (iconElement) {
                iconElement.classList.add('active');
            }

            let currentIndex = 0;

            function speakNext() {
                if (currentIndex < wordsToSpeak.length) {
                    const utterance = new SpeechSynthesisUtterance(wordsToSpeak[currentIndex]);
                    utterance.lang = 'en-US';
                    if (selectedVoice) utterance.voice = selectedVoice;
                    utterance.pitch = 1.1; 
                    utterance.rate = 0.9; 

                    utterance.onend = () => {
                        currentIndex++;
                        speakNext();
                    };
                    speechSynthesis.speak(utterance);
                } else {
                    if (iconElement) {
                        iconElement.classList.remove('active');
                    }
                }
            }
            speakNext();
        }

        function createSpeakerIcon() {
            const icon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            icon.setAttribute("class", "speaker-icon h-5 w-5 md:h-6 md:w-6");
            icon.setAttribute("fill", "none");
            icon.setAttribute("viewBox", "0 0 24 24");
            icon.setAttribute("stroke", "currentColor");
            icon.setAttribute("stroke-width", "2.5");
            icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />`;
            return icon;
        }

        function createTableCell(text, isHeader = false) {
            const cell = document.createElement(isHeader ? 'th' : 'td');
            cell.className = isHeader 
                ? 'px-4 py-4 text-center text-sm font-bold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200' 
                : 'px-4 py-4 text-center text-base md:text-lg text-slate-700 font-medium border-b border-slate-100 group-last:border-0';
            
            if (!isHeader) {
                const contentDiv = document.createElement('div');
                contentDiv.className = 'table-cell-content';
                contentDiv.appendChild(document.createTextNode(text));
                
                if (/^[a-zA-Z\s/]+$/.test(text)) { 
                     const speakerIcon = createSpeakerIcon();
                    speakerIcon.addEventListener('click', (e) => {
                        e.stopPropagation(); 
                        speak(text, speakerIcon);
                    });
                    contentDiv.appendChild(speakerIcon);
                }
                cell.appendChild(contentDiv);
            } else {
                cell.textContent = text;
            }
            return cell;
        }
        
        function createPlayAllCell(verb, isHeader = false) {
            const cell = document.createElement(isHeader ? 'th' : 'td');
            cell.className = isHeader
                ? 'px-2 py-4 text-center text-sm font-bold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200'
                : 'px-2 py-4 text-center border-b border-slate-100 group-last:border-0';

            if (!isHeader) {
                const button = document.createElement('button');
                button.className = 'p-2 rounded-full bg-blue-100 hover:bg-blue-200 text-blue-600 transition-colors';
                button.innerHTML = 'â–¶';
                button.title = "æ’­æ”¾æ•´è¡Œ";
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const icon = button; 
                    speak([verb.infinitive, verb.pastSimple, verb.pastParticiple, verb.presentParticiple], null);
                });
                cell.appendChild(button);
            } else {
                cell.textContent = "å…¨æ’­";
            }
            return cell;
        }

        function renderTables() {
            verbData.forEach(group => {
                const section = document.createElement('section');
                section.className = 'glass-panel rounded-3xl shadow-lg overflow-hidden transition-all hover:shadow-xl';
                
                const header = document.createElement('div');
                header.className = 'bg-gradient-to-r from-blue-500/10 to-purple-500/10 p-5 border-b border-white/50';
                const title = document.createElement('h2');
                title.className = 'text-xl md:text-2xl font-bold text-slate-800 flex items-center gap-2';
                title.innerHTML = `<span class="text-2xl">ğŸ“Œ</span> ${group.title}`;
                header.appendChild(title);
                section.appendChild(header);

                const tableContainer = document.createElement('div');
                tableContainer.className = 'overflow-x-auto';
                const table = document.createElement('table');
                table.className = 'min-w-full';

                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                ['å…¨æ’­', 'åŸå½¢', 'éå»å¼', 'éå»åˆ†è©', 'V-ing', 'ä¸­æ–‡'].forEach(text => {
                    headerRow.appendChild(createTableCell(text, true));
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);

                const tbody = document.createElement('tbody');
                tbody.className = 'bg-white';
                group.verbs.forEach(verb => {
                    const row = document.createElement('tr');
                    row.className = 'table-row-hover group';
                    row.appendChild(createPlayAllCell(verb));
                    row.appendChild(createTableCell(verb.infinitive));
                    row.appendChild(createTableCell(verb.pastSimple));
                    row.appendChild(createTableCell(verb.pastParticiple));
                    row.appendChild(createTableCell(verb.presentParticiple));
                    row.appendChild(createTableCell(verb.translation));
                    tbody.appendChild(row);
                });
                table.appendChild(tbody);
                tableContainer.appendChild(table);
                section.appendChild(tableContainer);
                verbTablesContainer.appendChild(section);
            });
        }
        
        function renderCategorySelector() {
            categorySelectorEl.innerHTML = '';
            verbData.forEach((group, index) => {
                const container = document.createElement('label');
                container.className = 'cursor-pointer select-none group relative';
                
                const input = document.createElement('input');
                input.type = 'checkbox';
                input.id = `category-${index}`;
                input.value = index;
                input.checked = true;
                input.className = 'peer sr-only'; 
                
                const visual = document.createElement('div');
                visual.className = 'px-4 py-2 bg-white border-2 border-slate-200 rounded-xl text-slate-500 font-bold transition-all peer-checked:border-blue-500 peer-checked:text-blue-600 peer-checked:bg-blue-50 hover:bg-slate-50';
                visual.textContent = group.title.split(' ')[1]; 

                container.appendChild(input);
                container.appendChild(visual);
                categorySelectorEl.appendChild(container);
            });
        }
        
        function updateScoreboard() {
            scoreEl.textContent = score;
            streakEl.textContent = streak;
            
            // æ›´æ–°æŒ‰éˆ•æ—çš„é€£å°è¨ˆæ•¸
            localStreakEl.innerHTML = `ğŸ”¥ x${streak}`;
            
            // æ•¸å­—è·³å‹•å‹•ç•«
            scoreEl.parentElement.classList.add('scale-110');
            setTimeout(() => scoreEl.parentElement.classList.remove('scale-110'), 150);
        }

        function startGame() {
            const selectedCategories = Array.from(document.querySelectorAll('#category-selector input:checked'));
            if (selectedCategories.length === 0) {
                alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹ç¯„åœå–”ï¼ğŸ˜…");
                return;
            }

            quizLobby.classList.add('hidden-section');
            quizInterface.classList.remove('hidden-section');
            
            score = 0;
            streak = 0;
            updateScoreboard();

            generateQuestion();
        }

        function returnToLobby() {
            quizInterface.classList.add('hidden-section');
            quizLobby.classList.remove('hidden-section');
        }

        function generateQuestion() {
            const selectedCategories = Array.from(document.querySelectorAll('#category-selector input:checked')).map(input => parseInt(input.value));
            const quizPool = verbData
                .filter((group, index) => selectedCategories.includes(index))
                .flatMap(group => group.verbs);

            if (quizPool.length === 0) return;

            const randomVerb = quizPool[Math.floor(Math.random() * quizPool.length)];
            const types = ['pastSimple', 'pastParticiple', 'presentParticiple'];
            const questionType = types[Math.floor(Math.random() * types.length)];
            
            let typeText = '';
            let typeColorClass = '';
            
            if (questionType === 'pastSimple') {
                typeText = 'éå»å¼';
                typeColorClass = 'text-yellow-300';
            } else if (questionType === 'pastParticiple') {
                typeText = 'éå»åˆ†è©';
                typeColorClass = 'text-green-300';
            } else {
                typeText = 'V-ing';
                typeColorClass = 'text-pink-300';
            }
            
            currentQuestion = {
                verb: randomVerb,
                type: questionType,
                answer: randomVerb[questionType]
            };

            questionText.innerHTML = `
                <div class="text-sm uppercase tracking-widest opacity-70 mb-2">Quiz Time</div>
                <span class="text-5xl md:text-6xl font-black block mb-4 filter drop-shadow-lg">${randomVerb.infinitive}</span>
                <div class="text-xl font-medium opacity-90">
                    è«‹è¼¸å…¥ <span class="${typeColorClass} font-bold underline decoration-wavy underline-offset-4">${typeText}</span>
                </div>
            `;
            
            // ä¿®æ”¹è™•ï¼šå¿µå‡ºç­”æ¡ˆ (å–ä»£åŸæœ¬å¿µ infinitive)
            // å°‡æ–œç·šæ›¿æ›ç‚º " or " é¿å…å¿µå‡ºç¬¦è™Ÿåç¨±
            speak(currentQuestion.answer.replace('/', ' or '));
            
            answerInput.value = '';
            answerInput.disabled = false;
            answerInput.focus();
            answerInput.parentElement.classList.remove('opacity-50'); 
            
            // UI é‡ç½®ï¼šé¡¯ç¤ºé€å‡ºï¼Œéš±è—ä¸‹ä¸€é¡Œ
            submitBtn.classList.remove('hidden-section');
            nextActionContainer.classList.add('hidden-section');
            
            feedbackContainer.innerHTML = '';
            feedbackContainer.className = 'mt-4 h-16 flex items-center justify-center text-xl md:text-2xl font-bold transition-all opacity-0';
            
            isQuestionAnswered = false;
        }

        function checkAnswer() {
            if (!currentQuestion) return;

            const userAnswer = answerInput.value.trim().toLowerCase();
            const correctAnswer = currentQuestion.answer.toLowerCase();

            feedbackContainer.classList.remove('opacity-0');

            if (userAnswer === '') {
                feedbackContainer.innerHTML = '<span class="text-amber-500 animate-pulse">âš¡ è«‹è¼¸å…¥ç­”æ¡ˆï¼</span>';
                return;
            }

            // æº–å‚™è¦å¿µçš„ç­”æ¡ˆç™¼éŸ³
            const answerSpeech = currentQuestion.answer.replace('/', ' or ');

            if (userAnswer === correctAnswer) {
                feedbackContainer.innerHTML = `
                    <div class="flex items-center gap-2 text-emerald-500 bounce-in">
                        <span class="text-3xl">ğŸ‰</span> 
                        <span>ç­”å°äº†ï¼ ${currentQuestion.answer}</span>
                    </div>`;
                score += 10;
                streak++;
                // ä¿®æ”¹è™•ï¼šç­”å°æ™‚å¿µ "Correct! [Answer]"
                speak(['Correct', answerSpeech]);
            } else {
                feedbackContainer.innerHTML = `
                    <div class="flex items-center gap-2 text-rose-500 bounce-in">
                        <span class="text-3xl">ğŸ’¥</span>
                        <span>éŒ¯äº†å–”... æ˜¯ ${currentQuestion.answer}</span>
                    </div>`;
                streak = 0;
                // ä¿®æ”¹è™•ï¼šç­”éŒ¯æ™‚å¿µ "Incorrect. [Answer]"
                speak(['Incorrect', answerSpeech]);
            }
            
            updateScoreboard();
            
            answerInput.disabled = true;
            answerInput.parentElement.classList.add('opacity-50'); 
            
            // UI åˆ‡æ›ï¼šéš±è—é€å‡ºï¼Œé¡¯ç¤ºä¸‹ä¸€é¡Œå€åŸŸ (åŒ…å«é€£å°)
            submitBtn.classList.add('hidden-section');
            nextActionContainer.classList.remove('hidden-section');
            nextQuestionBtn.focus();
            
            isQuestionAnswered = true;
        }

        // --- Tab Logic ---
        function switchTab(mode) {
            if (mode === 'study') {
                studyView.classList.remove('hidden-section');
                quizView.classList.add('hidden-section');
                
                tabStudy.classList.remove('text-slate-500', 'hover:bg-slate-100');
                tabStudy.classList.add('bg-gradient-to-r', 'from-violet-500', 'to-fuchsia-500', 'text-white', 'shadow-md', 'scale-105');
                
                tabQuiz.classList.remove('bg-gradient-to-r', 'from-violet-500', 'to-fuchsia-500', 'text-white', 'shadow-md', 'scale-105');
                tabQuiz.classList.add('text-slate-500', 'hover:bg-slate-100');

            } else {
                studyView.classList.add('hidden-section');
                quizView.classList.remove('hidden-section');
                
                tabQuiz.classList.remove('text-slate-500', 'hover:bg-slate-100');
                tabQuiz.classList.add('bg-gradient-to-r', 'from-violet-500', 'to-fuchsia-500', 'text-white', 'shadow-md', 'scale-105');
                
                tabStudy.classList.remove('bg-gradient-to-r', 'from-violet-500', 'to-fuchsia-500', 'text-white', 'shadow-md', 'scale-105');
                tabStudy.classList.add('text-slate-500', 'hover:bg-slate-100');
            }
        }

        tabStudy.addEventListener('click', () => switchTab('study'));
        tabQuiz.addEventListener('click', () => switchTab('quiz'));
        
        startGameBtn.addEventListener('click', startGame);
        backToLobbyBtn.addEventListener('click', returnToLobby);
        nextQuestionBtn.addEventListener('click', generateQuestion);
        submitBtn.addEventListener('click', checkAnswer);

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && !quizView.classList.contains('hidden-section') && !quizInterface.classList.contains('hidden-section')) {
                if (isQuestionAnswered) {
                    generateQuestion();
                } else {
                    checkAnswer();
                }
            }
        });

        loadVoices();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }

        renderTables();
        renderCategorySelector();
        updateScoreboard();
    </script>
</body>
</html>
