<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å‹•è©ä¸‰æ…‹äº’å‹•å­¸ç¿’ç¶²</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥å­—å‹ -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                        display: ['"Fredoka"', 'cursive'],
                    },
                    colors: {
                        'brand-blue': '#4facfe',
                        'brand-purple': '#00f2fe',
                        'game-bg': '#f3f4f6',
                    },
                    animation: {
                        'glow-pulse': 'glowPulse 1.5s infinite',
                    },
                    keyframes: {
                        glowPulse: {
                            '0%, 100%': { boxShadow: '0 0 0 0 rgba(250, 204, 21, 0.7)' },
                            '50%': { boxShadow: '0 0 0 10px rgba(250, 204, 21, 0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            min-height: 100vh;
            -webkit-overflow-scrolling: touch;
            overflow-x: hidden;
            user-select: none; 
            -webkit-user-select: none;
            /* ç¢ºä¿å…§å®¹ä¸æœƒè¢«ç€æµ·é®ä½ */
            padding-bottom: env(safe-area-inset-bottom);
        }

        .btn-3d {
            transition: all 0.1s;
            transform: translateY(0);
            border-bottom-width: 4px;
            touch-action: manipulation; 
        }
        .btn-3d:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
            margin-top: 2px;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* è¡¨æ ¼æ¨£å¼å„ªåŒ– */
        .table-row-base {
            transition: background-color 0.2s;
        }
        
        .selected-row {
            background-color: #fef08a !important; /* amber-200 */
            position: relative;
            z-index: 10;
        }

        .selected-col {
            background-color: #e0f2fe !important; /* sky-100 */
        }
        
        th.selected-col-header {
            background-color: #bae6fd !important; /* sky-200 */
            color: #0369a1; /* sky-700 */
            border-bottom: 2px solid #0ea5e9;
        }
        
        .selected-row td.selected-col {
            background-color: #fcd34d !important; /* amber-300 */
            font-weight: 800;
            color: #000;
            border: 2px solid #f59e0b;
        }
        
        th { cursor: pointer; }

        .speaker-icon {
            cursor: pointer;
            color: #6366f1;
            padding: 8px;
            margin: -6px;
        }
        .speaker-icon:active {
            color: #ec4899;
            transform: scale(1.1);
        }

        .hidden-section { display: none !important; }

        /* ç§»é™¤å®¹æ˜“é€ æˆå•é¡Œçš„æ·¡å…¥å‹•ç•«ï¼Œæ”¹ç”¨ç°¡å–®çš„é¡¯ç¤ºé‚è¼¯ */
        
        input[type="text"] {
            -webkit-appearance: none;
            border-radius: 1rem;
            font-size: 16px; 
        }

        .category-label.active {
            border-color: #3b82f6; 
            background-color: #eff6ff; 
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        
        /* éŒ¯èª¤è¨Šæ¯æ¨£å¼ */
        #error-log {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(220, 38, 38, 0.9);
            color: white;
            padding: 10px;
            font-size: 12px;
            z-index: 9999;
            text-align: left;
            white-space: pre-wrap;
        }
    </style>
</head>
<body class="text-slate-700 antialiased">

    <!-- ç”¨æ–¼é¡¯ç¤º JS éŒ¯èª¤ï¼Œæ–¹ä¾¿é™¤éŒ¯ -->
    <div id="error-log"></div>

    <div class="container mx-auto px-3 py-6 md:px-4 md:py-8 max-w-6xl relative z-10">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 tracking-tight font-display drop-shadow-sm mb-3 md:mb-4">
                å‹•è©ä¸‰æ…‹å¤§æŒ‘æˆ°
            </h1>
            <p class="text-xs md:text-xl text-slate-600 font-medium bg-white/60 inline-block px-4 py-2 rounded-full shadow-sm backdrop-blur-sm">
                ğŸ§ é»æ“Šå–‡å­è½ç™¼éŸ³ Â· ğŸ‘† é»æ“Šè¡Œåˆ—åšæ¨™è¨˜
            </p>
        </header>

        <!-- å°èˆªæŒ‰éˆ• -->
        <div class="flex justify-center mb-8">
            <div class="bg-white/80 p-1.5 md:p-2 rounded-2xl shadow-lg backdrop-blur flex gap-2 w-full max-w-md md:w-auto">
                <button id="tab-study" class="flex-1 md:flex-none px-4 md:px-8 py-3 rounded-xl font-bold text-base md:text-lg transition-all duration-300 flex items-center justify-center gap-2 bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white shadow-md transform scale-100 md:scale-105">
                    <span>ğŸ“–</span> <span class="hidden md:inline">å–®å­—è¡¨</span>å­¸ç¿’
                </button>
                <button id="tab-quiz" class="flex-1 md:flex-none px-4 md:px-8 py-3 rounded-xl font-bold text-base md:text-lg transition-all duration-300 flex items-center justify-center gap-2 text-slate-500 hover:bg-slate-100">
                    <span>ğŸ®</span> <span class="hidden md:inline">éš¨æ©Ÿ</span>æ¸¬é©—
                </button>
            </div>
        </div>

        <!-- å­¸ç¿’å€å¡Š (é è¨­åŠ å…¥æ–‡å­—ï¼Œè‹¥ JS å¤±æ•—çœ‹å¾—åˆ°) -->
        <div id="study-view" class="pb-10">
            <main id="verb-tables" class="space-y-8 md:space-y-10">
                <div class="text-center p-10 text-slate-500 bg-white/50 rounded-xl">
                    <p class="text-xl font-bold animate-pulse">æ­£åœ¨æº–å‚™èª²ç¨‹è³‡æ–™...</p>
                    <p class="text-sm mt-2">å¦‚æœé•·æ™‚é–“åœç•™åœ¨æ­¤ï¼Œè«‹å˜—è©¦é‡æ–°æ•´ç†</p>
                </div>
            </main>
        </div>

        <!-- æ¸¬é©—å€å¡Š -->
        <div id="quiz-view" class="hidden-section pb-10">
            <section class="max-w-4xl mx-auto">
                
                <div class="glass-panel rounded-3xl shadow-2xl overflow-hidden min-h-[500px] flex flex-col relative">
                    
                    <div class="h-3 bg-gradient-to-r from-yellow-400 via-red-500 to-pink-500 w-full"></div>

                    <!-- Lobby (æº–å‚™ç•«é¢) -->
                    <div id="quiz-lobby" class="flex-1 flex flex-col items-center justify-center p-6 md:p-8 text-center">
                        <div class="text-6xl md:text-8xl mb-4 md:mb-6">ğŸš€</div>
                        <h2 class="text-2xl md:text-4xl font-black text-slate-800 mb-3 md:mb-4">æº–å‚™å¥½æ¥å—æŒ‘æˆ°äº†å—ï¼Ÿ</h2>
                        <p class="text-base md:text-xl text-slate-600 mb-8 max-w-md">é¸æ“‡ä¸‹æ–¹çš„ç¯„åœï¼Œæ¸¬è©¦ä½ å°å‹•è©ä¸‰æ…‹çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼</p>
                        
                        <div class="mb-8 bg-white/60 p-5 rounded-2xl border border-white shadow-inner w-full max-w-2xl">
                            <h3 class="text-base md:text-lg font-bold text-slate-700 mb-4 flex items-center justify-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                                è«‹å‹¾é¸æ¸¬é©—ç¯„åœ
                                <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                            </h3>
                            <!-- ç¯„åœé¸æ“‡å™¨å®¹å™¨ -->
                            <div id="category-selector" class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-left">
                                <!-- JS Generated Checkboxes -->
                            </div>
                        </div>

                        <button id="start-game-btn" class="btn-3d w-full sm:w-auto px-10 py-4 bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-black text-xl md:text-2xl rounded-2xl shadow-xl border-blue-600 hover:brightness-110 active:scale-95 flex items-center justify-center gap-3">
                            é–‹å§‹æŒ‘æˆ° GO!
                        </button>
                    </div>

                    <!-- Interface (æ¸¬é©—é€²è¡Œä¸­) -->
                    <div id="quiz-interface" class="hidden-section flex-1 flex flex-col p-4 md:p-10">
                        
                        <!-- HUD -->
                        <div class="flex justify-between items-center mb-6 md:mb-8">
                            <button id="back-to-lobby-btn" class="px-3 py-2 bg-slate-100 rounded-lg text-sm font-bold text-slate-500 hover:text-slate-700 hover:bg-slate-200 flex items-center gap-1 transition-colors">
                                â† è¨­å®š
                            </button>
                            <div class="flex gap-2 md:gap-4">
                                <div class="bg-white px-3 py-1.5 md:px-4 md:py-2 rounded-xl shadow-sm border border-slate-100 flex flex-col items-center min-w-[70px] md:min-w-[100px]">
                                    <span class="text-[10px] md:text-xs font-bold text-slate-400 uppercase tracking-wider">Score</span>
                                    <span id="score" class="text-xl md:text-2xl font-black text-blue-600 leading-none">0</span>
                                </div>
                                <div class="bg-white px-3 py-1.5 md:px-4 md:py-2 rounded-xl shadow-sm border border-slate-100 flex flex-col items-center min-w-[70px] md:min-w-[100px]">
                                    <span class="text-[10px] md:text-xs font-bold text-slate-400 uppercase tracking-wider">Streak</span>
                                    <span id="streak" class="text-xl md:text-2xl font-black text-orange-500 leading-none">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Question Area -->
                        <div class="flex-1 flex flex-col items-center justify-start md:justify-center max-w-3xl mx-auto w-full">
                            
                            <div class="w-full bg-gradient-to-br from-indigo-600 to-purple-700 text-white rounded-2xl p-6 md:p-12 shadow-xl mb-6 text-center relative overflow-hidden group">
                                <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl md:text-9xl font-display select-none pointer-events-none">?</div>
                                <p id="question-text" class="text-xl md:text-4xl font-bold leading-relaxed relative z-10">
                                    Loading...
                                </p>
                            </div>

                            <div class="w-full space-y-4">
                                <!-- inputmode="text" å¹«åŠ©æ‰‹æ©Ÿå½ˆå‡ºæ­£ç¢ºéµç›¤ -->
                                <input type="text" id="answer-input" inputmode="text" autocomplete="off" autocapitalize="off" spellcheck="false" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ..." class="w-full text-center text-xl md:text-3xl font-bold py-4 px-4 md:py-5 md:px-6 rounded-2xl border-4 border-slate-200 focus:border-purple-400 focus:ring-4 focus:ring-purple-100 outline-none transition-all placeholder:text-slate-300 bg-white shadow-inner text-slate-700 select-text">
                                
                                <!-- æŒ‰éˆ•å€åŸŸ -->
                                <div class="h-20 md:h-24 w-full relative flex gap-3">
                                    <button id="submit-btn" class="btn-3d w-full h-full bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-bold text-lg md:text-2xl rounded-2xl shadow-lg border-emerald-600 hover:brightness-110 active:scale-95 transition-all">
                                        é€å‡º (Enter)
                                    </button>
                                    
                                    <div id="next-action-container" class="hidden-section w-full h-full flex gap-2 md:gap-3">
                                        <div class="w-1/3 h-full bg-orange-100 rounded-2xl border-4 border-orange-200 flex flex-col items-center justify-center shadow-inner">
                                            <span class="text-[10px] md:text-xs font-bold text-orange-400 uppercase">Streak</span>
                                            <div id="local-streak" class="text-2xl md:text-3xl font-black text-orange-500 flex items-center gap-1">
                                                ğŸ”¥ x0
                                            </div>
                                        </div>

                                        <button id="next-question-btn" class="btn-3d flex-1 h-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold text-lg md:text-2xl rounded-2xl shadow-lg border-yellow-600 hover:brightness-110 active:scale-95 transition-all flex items-center justify-center gap-2 animate-glow-pulse">
                                            ä¸‹ä¸€é¡Œ <span>â”</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div id="feedback-container" class="mt-4 h-12 md:h-16 flex items-center justify-center text-lg md:text-2xl font-bold transition-all opacity-0 px-2 text-center">
                                <!-- Feedback -->
                            </div>

                        </div>
                    </div>

                </div>
            </section>
        </div>

    </div>

    <script>
        // å…¨åŸŸéŒ¯èª¤è™•ç†ï¼šå¦‚æœæ‰‹æ©Ÿå ±éŒ¯ï¼Œæœƒé¡¯ç¤ºåœ¨ç•«é¢ä¸Š
        window.onerror = function(message, source, lineno, colno, error) {
            const errorLog = document.getElementById('error-log');
            errorLog.style.display = 'block';
            errorLog.textContent += `Error: ${message} at line ${lineno}\n`;
            return false;
        };

        // è³‡æ–™é›†
        const verbData = [
            {
                title: "1. è¦å‰‡å‹•è© (Regular)",
                verbs: [
                    { infinitive: 'ask', pastSimple: 'asked', pastParticiple: 'asked', presentParticiple: 'asking', translation: 'å•' },
                    { infinitive: 'learn', pastSimple: 'learned', pastParticiple: 'learned', presentParticiple: 'learning', translation: 'å­¸ç¿’' },
                    { infinitive: 'start', pastSimple: 'started', pastParticiple: 'started', presentParticiple: 'starting', translation: 'é–‹å§‹' },
                    { infinitive: 'play', pastSimple: 'played', pastParticiple: 'played', presentParticiple: 'playing', translation: 'ç©' },
                    { infinitive: 'die', pastSimple: 'died', pastParticiple: 'died', presentParticiple: 'dying', translation: 'æ­»äº¡' },
                    { infinitive: 'close', pastSimple: 'closed', pastParticiple: 'closed', presentParticiple: 'closing', translation: 'é—œé–‰' },
                    { infinitive: 'like', pastSimple: 'liked', pastParticiple: 'liked', presentParticiple: 'liking', translation: 'å–œæ­¡' },
                    { infinitive: 'hope', pastSimple: 'hoped', pastParticiple: 'hoped', presentParticiple: 'hoping', translation: 'å¸Œæœ›' }
                ]
            },
            {
                title: "2. A-A-A å‹ (åŒå½¢)",
                verbs: [
                    { infinitive: 'cost', pastSimple: 'cost', pastParticiple: 'cost', presentParticiple: 'costing', translation: 'èŠ±è²»' },
                    { infinitive: 'cut', pastSimple: 'cut', pastParticiple: 'cut', presentParticiple: 'cutting', translation: 'å‰²' },
                    { infinitive: 'hit', pastSimple: 'hit', pastParticiple: 'hit', presentParticiple: 'hitting', translation: 'æ‰“' },
                    { infinitive: 'let', pastSimple: 'let', pastParticiple: 'let', presentParticiple: 'letting', translation: 'å…è¨±' },
                    { infinitive: 'put', pastSimple: 'put', pastParticiple: 'put', presentParticiple: 'putting', translation: 'æ”¾ç½®' },
                    { infinitive: 'read', pastSimple: 'read', pastParticiple: 'read', presentParticiple: 'reading', translation: 'é–±è®€' },
                    { infinitive: 'set', pastSimple: 'set', pastParticiple: 'set', presentParticiple: 'setting', translation: 'è¨­ç½®' },
                    { infinitive: 'spread', pastSimple: 'spread', pastParticiple: 'spread', presentParticiple: 'spreading', translation: 'å±•é–‹' },
                    { infinitive: 'fit', pastSimple: 'fit', pastParticiple: 'fit', presentParticiple: 'fitting', translation: 'åˆèº«' },
                    { infinitive: 'hurt', pastSimple: 'hurt', pastParticiple: 'hurt', presentParticiple: 'hurting', translation: 'å‚·å®³' },
                    { infinitive: 'quit', pastSimple: 'quit', pastParticiple: 'quit', presentParticiple: 'quitting', translation: 'æ”¾æ£„' },
                    { infinitive: 'shut', pastSimple: 'shut', pastParticiple: 'shut', presentParticiple: 'shutting', translation: 'é—œé–‰' }
                ]
            },
            {
                title: "3. A-B-B å‹ (äºŒæ…‹åŒ)",
                verbs: [
                    { infinitive: 'buy', pastSimple: 'bought', pastParticiple: 'bought', presentParticiple: 'buying', translation: 'è³¼è²·' },
                    { infinitive: 'sell', pastSimple: 'sold', pastParticiple: 'sold', presentParticiple: 'selling', translation: 'è²©è³£' },
                    { infinitive: 'hold', pastSimple: 'held', pastParticiple: 'held', presentParticiple: 'holding', translation: 'æ¡ä½' },
                    { infinitive: 'tell', pastSimple: 'told', pastParticiple: 'told', presentParticiple: 'telling', translation: 'å‘Šè¨´' },
                    { infinitive: 'think', pastSimple: 'thought', pastParticiple: 'thought', presentParticiple: 'thinking', translation: 'æ€è€ƒ' },
                    { infinitive: 'bring', pastSimple: 'brought', pastParticiple: 'brought', presentParticiple: 'bringing', translation: 'å¸¶ä¾†' },
                    { infinitive: 'meet', pastSimple: 'met', pastParticiple: 'met', presentParticiple: 'meeting', translation: 'é‡è¦‹' },
                    { infinitive: 'keep', pastSimple: 'kept', pastParticiple: 'kept', presentParticiple: 'keeping', translation: 'ä¿æŒ' },
                    { infinitive: 'sleep', pastSimple: 'slept', pastParticiple: 'slept', presentParticiple: 'sleeping', translation: 'ç¡è¦º' },
                    { infinitive: 'find', pastSimple: 'found', pastParticiple: 'found', presentParticiple: 'finding', translation: 'ç™¼ç¾' },
                    { infinitive: 'seek', pastSimple: 'sought', pastParticiple: 'sought', presentParticiple: 'seeking', translation: 'å°‹æ‰¾' },
                    { infinitive: 'teach', pastSimple: 'taught', pastParticiple: 'taught', presentParticiple: 'teaching', translation: 'æ•™' },
                    { infinitive: 'spend', pastSimple: 'spent', pastParticiple: 'spent', presentParticiple: 'spending', translation: 'èŠ±è²»' },
                    { infinitive: 'send', pastSimple: 'sent', pastParticiple: 'sent', presentParticiple: 'sending', translation: 'å¯„é€' },
                    { infinitive: 'stand', pastSimple: 'stood', pastParticiple: 'stood', presentParticiple: 'standing', translation: 'ç«™ç«‹' },
                    { infinitive: 'feel', pastSimple: 'felt', pastParticiple: 'felt', presentParticiple: 'feeling', translation: 'æ„Ÿè¦º' },
                    { infinitive: 'catch', pastSimple: 'caught', pastParticiple: 'caught', presentParticiple: 'catching', translation: 'æ•æŠ“' },
                    { infinitive: 'hear', pastSimple: 'heard', pastParticiple: 'heard', presentParticiple: 'hearing', translation: 'è½è¦‹' },
                    { infinitive: 'build', pastSimple: 'built', pastParticiple: 'built', presentParticiple: 'building', translation: 'èˆˆå»º' },
                    { infinitive: 'bend', pastSimple: 'bent', pastParticiple: 'bent', presentParticiple: 'bending', translation: 'å½æ›²' },
                    { infinitive: 'burn', pastSimple: 'burnt', pastParticiple: 'burnt', presentParticiple: 'burning', translation: 'ç‡ƒç‡’' },
                    { infinitive: 'deal', pastSimple: 'dealt', pastParticiple: 'dealt', presentParticiple: 'dealing', translation: 'è™•ç†' },
                    { infinitive: 'dig', pastSimple: 'dug', pastParticiple: 'dug', presentParticiple: 'digging', translation: 'æŒ–' },
                    { infinitive: 'dive', pastSimple: 'dove', pastParticiple: 'dove', presentParticiple: 'diving', translation: 'æ½›æ°´' },
                    { infinitive: 'feed', pastSimple: 'fed', pastParticiple: 'fed', presentParticiple: 'feeding', translation: 'é¤µ' },
                    { infinitive: 'fight', pastSimple: 'fought', pastParticiple: 'fought', presentParticiple: 'fighting', translation: 'æ‰“æ¶' },
                    { infinitive: 'get', pastSimple: 'got', pastParticiple: 'got', presentParticiple: 'getting', translation: 'å¾—åˆ°' },
                    { infinitive: 'hang', pastSimple: 'hung', pastParticiple: 'hung', presentParticiple: 'hanging', translation: 'æ‡¸æ›' },
                    { infinitive: 'have', pastSimple: 'had', pastParticiple: 'had', presentParticiple: 'having', translation: 'æœ‰;åƒ' },
                    { infinitive: 'lead', pastSimple: 'led', pastParticiple: 'led', presentParticiple: 'leading', translation: 'é ˜å°' },
                    { infinitive: 'leave', pastSimple: 'left', pastParticiple: 'left', presentParticiple: 'leaving', translation: 'é›¢é–‹' },
                    { infinitive: 'lend', pastSimple: 'lent', pastParticiple: 'lent', presentParticiple: 'lending', translation: 'å€Ÿå‡º' },
                    { infinitive: 'light', pastSimple: 'lit', pastParticiple: 'lit', presentParticiple: 'lighting', translation: 'é»ç‡ƒ' },
                    { infinitive: 'lose', pastSimple: 'lost', pastParticiple: 'lost', presentParticiple: 'losing', translation: 'å¤±å»' },
                    { infinitive: 'make', pastSimple: 'made', pastParticiple: 'made', presentParticiple: 'making', translation: 'è£½ä½œ' },
                    { infinitive: 'mean', pastSimple: 'meant', pastParticiple: 'meant', presentParticiple: 'meaning', translation: 'æ„æŒ‡' },
                    { infinitive: 'pay', pastSimple: 'paid', pastParticiple: 'paid', presentParticiple: 'paying', translation: 'ä»˜è²»' },
                    { infinitive: 'say', pastSimple: 'said', pastParticiple: 'said', presentParticiple: 'saying', translation: 'èªª' },
                    { infinitive: 'shine', pastSimple: 'shone', pastParticiple: 'shone', presentParticiple: 'shining', translation: 'ç…§è€€' },
                    { infinitive: 'shoot', pastSimple: 'shot', pastParticiple: 'shot', presentParticiple: 'shooting', translation: 'å°„æ“Š' },
                    { infinitive: 'sit', pastSimple: 'sat', pastParticiple: 'sat', presentParticiple: 'sitting', translation: 'å' },
                    { infinitive: 'smell', pastSimple: 'smelt', pastParticiple: 'smelt', presentParticiple: 'smelling', translation: 'è' },
                    { infinitive: 'spell', pastSimple: 'spelt', pastParticiple: 'spelt', presentParticiple: 'spelling', translation: 'æ‹¼å­—' },
                    { infinitive: 'stick', pastSimple: 'stuck', pastParticiple: 'stuck', presentParticiple: 'sticking', translation: 'é»' },
                    { infinitive: 'sweep', pastSimple: 'swept', pastParticiple: 'swept', presentParticiple: 'sweeping', translation: 'æ¸…æƒ' },
                    { infinitive: 'understand', pastSimple: 'understood', pastParticiple: 'understood', presentParticiple: 'understanding', translation: 'äº†è§£' },
                    { infinitive: 'win', pastSimple: 'won', pastParticiple: 'won', presentParticiple: 'winning', translation: 'è´' }
                ]
            },
            {
                title: "4. A-B-C å‹ (å…¨ç•°)",
                verbs: [
                    { infinitive: 'ride', pastSimple: 'rode', pastParticiple: 'ridden', presentParticiple: 'riding', translation: 'é¨' },
                    { infinitive: 'drive', pastSimple: 'drove', pastParticiple: 'driven', presentParticiple: 'driving', translation: 'é–‹è»Š' },
                    { infinitive: 'shake', pastSimple: 'shook', pastParticiple: 'shaken', presentParticiple: 'shaking', translation: 'éœ‡å‹•' },
                    { infinitive: 'choose', pastSimple: 'chose', pastParticiple: 'chosen', presentParticiple: 'choosing', translation: 'é¸æ“‡' },
                    { infinitive: 'break', pastSimple: 'broke', pastParticiple: 'broken', presentParticiple: 'breaking', translation: 'æ‰“ç ´' },
                    { infinitive: 'speak', pastSimple: 'spoke', pastParticiple: 'spoken', presentParticiple: 'speaking', translation: 'èªªè©±' },
                    { infinitive: 'write', pastSimple: 'wrote', pastParticiple: 'written', presentParticiple: 'writing', translation: 'å¯«' },
                    { infinitive: 'eat', pastSimple: 'ate', pastParticiple: 'eaten', presentParticiple: 'eating', translation: 'åƒ' },
                    { infinitive: 'fall', pastSimple: 'fell', pastParticiple: 'fallen', presentParticiple: 'falling', translation: 'è½ä¸‹' },
                    { infinitive: 'forget', pastSimple: 'forgot', pastParticiple: 'forgotten', presentParticiple: 'forgetting', translation: 'å¿˜è¨˜' },
                    { infinitive: 'begin', pastSimple: 'began', pastParticiple: 'begun', presentParticiple: 'beginning', translation: 'é–‹å§‹' },
                    { infinitive: 'drink', pastSimple: 'drank', pastParticiple: 'drunk', presentParticiple: 'drinking', translation: 'å–' },
                    { infinitive: 'know', pastSimple: 'knew', pastParticiple: 'known', presentParticiple: 'knowing', translation: 'çŸ¥é“' },
                    { infinitive: 'fly', pastSimple: 'flew', pastParticiple: 'flown', presentParticiple: 'flying', translation: 'é£›' },
                    { infinitive: 'go', pastSimple: 'went', pastParticiple: 'gone', presentParticiple: 'going', translation: 'å»' },
                    { infinitive: 'see', pastSimple: 'saw', pastParticiple: 'seen', presentParticiple: 'seeing', translation: 'çœ‹è¦‹' },
                    { infinitive: 'grow', pastSimple: 'grew', pastParticiple: 'grown', presentParticiple: 'growing', translation: 'ç”Ÿé•·' },
                    { infinitive: 'swim', pastSimple: 'swam', pastParticiple: 'swum', presentParticiple: 'swimming', translation: 'æ¸¸æ³³' },
                    { infinitive: 'do', pastSimple: 'did', pastParticiple: 'done', presentParticiple: 'doing', translation: 'åš' },
                    { infinitive: 'be', pastSimple: 'was/were', pastParticiple: 'been', presentParticiple: 'being', translation: 'æ˜¯' },
                    { infinitive: 'bear', pastSimple: 'bore', pastParticiple: 'born', presentParticiple: 'bearing', translation: 'ç”Ÿ' },
                    { infinitive: 'beat', pastSimple: 'beat', pastParticiple: 'beaten', presentParticiple: 'beating', translation: 'æ‰“æ•—' },
                    { infinitive: 'bite', pastSimple: 'bit', pastParticiple: 'bitten', presentParticiple: 'biting', translation: 'å’¬' },
                    { infinitive: 'blow', pastSimple: 'blew', pastParticiple: 'blown', presentParticiple: 'blowing', translation: 'å¹' },
                    { infinitive: 'draw', pastSimple: 'drew', pastParticiple: 'drawn', presentParticiple: 'drawing', translation: 'ç•«' },
                    { infinitive: 'forgive', pastSimple: 'forgave', pastParticiple: 'forgiven', presentParticiple: 'forgiving', translation: 'åŸè«’' },
                    { infinitive: 'freeze', pastSimple: 'froze', pastParticiple: 'frozen', presentParticiple: 'freezing', translation: 'å‡çµ' },
                    { infinitive: 'get', pastSimple: 'got', pastParticiple: 'gotten', presentParticiple: 'getting', translation: 'ç²å¾—' },
                    { infinitive: 'give', pastSimple: 'gave', pastParticiple: 'given', presentParticiple: 'giving', translation: 'çµ¦' },
                    { infinitive: 'hide', pastSimple: 'hid', pastParticiple: 'hidden', presentParticiple: 'hiding', translation: 'èº²è—' },
                    { infinitive: 'lie', pastSimple: 'lay', pastParticiple: 'lain', presentParticiple: 'lying', translation: 'èºº' },
                    { infinitive: 'ring', pastSimple: 'rang', pastParticiple: 'rung', presentParticiple: 'ringing', translation: 'éˆ´éŸ¿' },
                    { infinitive: 'rise', pastSimple: 'rose', pastParticiple: 'risen', presentParticiple: 'rising', translation: 'ä¸Šå‡' },
                    { infinitive: 'show', pastSimple: 'showed', pastParticiple: 'shown', presentParticiple: 'showing', translation: 'å±•ç¤º' },
                    { infinitive: 'sing', pastSimple: 'sang', pastParticiple: 'sung', presentParticiple: 'singing', translation: 'å”±' },
                    { infinitive: 'steal', pastSimple: 'stole', pastParticiple: 'stolen', presentParticiple: 'stealing', translation: 'å·' },
                    { infinitive: 'take', pastSimple: 'took', pastParticiple: 'taken', presentParticiple: 'taking', translation: 'æ‹¿' },
                    { infinitive: 'throw', pastSimple: 'threw', pastParticiple: 'thrown', presentParticiple: 'throwing', translation: 'ä¸Ÿ' },
                    { infinitive: 'wake', pastSimple: 'woke', pastParticiple: 'woken', presentParticiple: 'waking', translation: 'é†’ä¾†' },
                    { infinitive: 'wear', pastSimple: 'wore', pastParticiple: 'worn', presentParticiple: 'wearing', translation: 'ç©¿' },
                    { infinitive: 'write', pastSimple: 'wrote', pastParticiple: 'written', presentParticiple: 'writing', translation: 'å¯«' }
                ]
            },
            {
                title: "5. A-B-A å‹ (è¿´æ—‹)",
                verbs: [
                    { infinitive: 'run', pastSimple: 'ran', pastParticiple: 'run', presentParticiple: 'running', translation: 'è·‘' },
                    { infinitive: 'come', pastSimple: 'came', pastParticiple: 'come', presentParticiple: 'coming', translation: 'ä¾†' },
                    { infinitive: 'become', pastSimple: 'became', pastParticiple: 'become', presentParticiple: 'becoming', translation: 'è®Šæˆ' },
                    { infinitive: 'overcome', pastSimple: 'overcame', pastParticiple: 'overcome', presentParticiple: 'overcoming', translation: 'å…‹æœ' }
                ]
            }
        ];

        let currentQuestion = null;
        let score = 0;
        let streak = 0;
        let isQuestionAnswered = false;
        
        // DOM Elements
        const verbTablesContainer = document.getElementById('verb-tables');
        const questionText = document.getElementById('question-text');
        const answerInput = document.getElementById('answer-input');
        const submitBtn = document.getElementById('submit-btn');
        const nextActionContainer = document.getElementById('next-action-container');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const localStreakEl = document.getElementById('local-streak');
        
        const feedbackContainer = document.getElementById('feedback-container');
        const scoreEl = document.getElementById('score');
        const streakEl = document.getElementById('streak');
        const categorySelectorEl = document.getElementById('category-selector');
        
        const quizLobby = document.getElementById('quiz-lobby');
        const quizInterface = document.getElementById('quiz-interface');
        const startGameBtn = document.getElementById('start-game-btn');
        const backToLobbyBtn = document.getElementById('back-to-lobby-btn');

        // Tabs
        const tabStudy = document.getElementById('tab-study');
        const tabQuiz = document.getElementById('tab-quiz');
        const studyView = document.getElementById('study-view');
        const quizView = document.getElementById('quiz-view');

        // Voice
        let selectedVoice = null;
        let voicesLoaded = false;

        // å®‰å“æ‰‹æ©Ÿåœ¨ç¬¬ä¸€æ¬¡äº’å‹•æ™‚ï¼Œå¿…é ˆ"è§£é–"éŸ³é »ç’°å¢ƒ
        function unlockAudio() {
            if (typeof SpeechSynthesisUtterance === "undefined") return;
            const u = new SpeechSynthesisUtterance("");
            speechSynthesis.speak(u);
            document.removeEventListener('click', unlockAudio);
            document.removeEventListener('touchstart', unlockAudio);
        }
        document.addEventListener('click', unlockAudio);
        document.addEventListener('touchstart', unlockAudio);

        function loadVoices() {
            if (voicesLoaded) return;
            try {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return; 

                selectedVoice = voices.find(voice => voice.name === 'Google US English' && voice.lang === 'en-US');
                if (!selectedVoice) selectedVoice = voices.find(voice => voice.lang === 'en-US');
                if (!selectedVoice) selectedVoice = voices.find(voice => voice.lang.startsWith('en'));
                
                voicesLoaded = true;
            } catch (e) {
                console.log("Voice load error, ignoring");
            }
        }

        function speak(texts, iconElement = null) {
            if (!('speechSynthesis' in window)) return;
            if (!voicesLoaded) loadVoices();

            const wordsToSpeak = Array.isArray(texts) ? texts : [texts];
            if (wordsToSpeak.length === 0) return;

            speechSynthesis.cancel(); 
            
            document.querySelectorAll('.speaker-icon.active').forEach(icon => {
                icon.classList.remove('active');
            });

            if (iconElement) {
                iconElement.classList.add('active');
            }

            let currentIndex = 0;

            function speakNext() {
                if (currentIndex < wordsToSpeak.length) {
                    const text = wordsToSpeak[currentIndex];
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US'; 
                    if (selectedVoice) utterance.voice = selectedVoice;
                    utterance.pitch = 1; 
                    utterance.rate = 0.9; 

                    utterance.onend = () => {
                        currentIndex++;
                        speakNext();
                    };
                    
                    utterance.onerror = (e) => {
                         if (iconElement) iconElement.classList.remove('active');
                    };

                    speechSynthesis.speak(utterance);
                } else {
                    if (iconElement) {
                        iconElement.classList.remove('active');
                    }
                }
            }
            speakNext();
        }

        function createSpeakerIcon() {
            const icon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            icon.setAttribute("class", "speaker-icon h-7 w-7 md:h-6 md:w-6"); 
            icon.setAttribute("fill", "none");
            icon.setAttribute("viewBox", "0 0 24 24");
            icon.setAttribute("stroke", "currentColor");
            icon.setAttribute("stroke-width", "2.5");
            icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />`;
            return icon;
        }

        function createTableCell(text, isHeader = false) {
            const cell = document.createElement(isHeader ? 'th' : 'td');
            cell.className = isHeader 
                ? 'px-2 py-3 md:px-4 md:py-4 text-center text-xs md:text-sm font-bold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 whitespace-nowrap' 
                : 'px-2 py-3 md:px-4 md:py-4 text-center text-sm md:text-lg text-slate-700 font-medium border-b border-slate-100 group-last:border-0';
            
            if (!isHeader) {
                const contentDiv = document.createElement('div');
                contentDiv.className = 'table-cell-content flex items-center justify-center gap-1 md:gap-2 min-h-[44px]'; 
                contentDiv.appendChild(document.createTextNode(text));
                
                if (/^[a-zA-Z\s/]+$/.test(text)) { 
                     const speakerIcon = createSpeakerIcon();
                    speakerIcon.addEventListener('click', (e) => {
                        e.stopPropagation(); 
                        speak(text, speakerIcon);
                    });
                    contentDiv.appendChild(speakerIcon);
                }
                cell.appendChild(contentDiv);
            } else {
                cell.textContent = text;
            }
            return cell;
        }
        
        function createPlayAllCell(verb, isHeader = false) {
            const cell = document.createElement(isHeader ? 'th' : 'td');
            cell.className = isHeader
                ? 'px-2 py-3 md:px-2 md:py-4 text-center text-xs md:text-sm font-bold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200'
                : 'px-2 py-3 md:px-2 md:py-4 text-center border-b border-slate-100 group-last:border-0';

            if (!isHeader) {
                const button = document.createElement('button');
                button.className = 'p-2 md:p-2 rounded-full bg-blue-100 hover:bg-blue-200 text-blue-600 transition-colors focus:outline-none active:bg-blue-300 touch-manipulation';
                button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-5 md:w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>';
                button.title = "æ’­æ”¾æ•´è¡Œ";
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const icon = button; 
                    speak([verb.infinitive, verb.pastSimple, verb.pastParticiple, verb.presentParticiple], null);
                });
                cell.appendChild(button);
            } else {
                cell.textContent = "å…¨æ’­";
            }
            return cell;
        }

        function handleColumnClick(table, colIndex) {
            const currentHeader = table.querySelector(`th:nth-child(${colIndex + 1})`);
            const isAlreadySelected = currentHeader.classList.contains('selected-col-header');

            table.querySelectorAll('.selected-col').forEach(el => el.classList.remove('selected-col'));
            table.querySelectorAll('.selected-col-header').forEach(el => el.classList.remove('selected-col-header'));

            if (!isAlreadySelected) {
                currentHeader.classList.add('selected-col-header');
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const cell = row.children[colIndex];
                    if (cell) cell.classList.add('selected-col');
                });
            }
        }

        function renderTables() {
            try {
                // æ¸…ç©ºè¼‰å…¥ä¸­æç¤º
                verbTablesContainer.innerHTML = '';

                verbData.forEach(group => {
                    const section = document.createElement('section');
                    section.className = 'glass-panel rounded-3xl shadow-lg overflow-hidden transition-all hover:shadow-xl mb-6';
                    
                    const header = document.createElement('div');
                    header.className = 'bg-gradient-to-r from-blue-500/10 to-purple-500/10 p-4 md:p-5 border-b border-white/50';
                    const title = document.createElement('h2');
                    title.className = 'text-lg md:text-2xl font-bold text-slate-800 flex items-center gap-2';
                    title.innerHTML = `<span class="text-xl md:text-2xl">ğŸ“Œ</span> ${group.title}`;
                    header.appendChild(title);
                    section.appendChild(header);

                    const tableContainer = document.createElement('div');
                    tableContainer.className = 'overflow-x-auto';
                    const table = document.createElement('table');
                    table.className = 'min-w-full';

                    const thead = document.createElement('thead');
                    const headerRow = document.createElement('tr');
                    
                    const headers = ['å…¨æ’­', 'åŸå½¢', 'éå»å¼', 'éå»åˆ†è©', 'V-ing', 'ä¸­æ–‡'];
                    headers.forEach((text, index) => {
                        const th = createTableCell(text, true);
                        th.addEventListener('click', () => handleColumnClick(table, index));
                        headerRow.appendChild(th);
                    });
                    
                    thead.appendChild(headerRow);
                    table.appendChild(thead);

                    const tbody = document.createElement('tbody');
                    tbody.className = 'bg-white';
                    group.verbs.forEach(verb => {
                        const row = document.createElement('tr');
                        row.className = 'table-row-base cursor-pointer even:bg-slate-50';
                        
                        row.addEventListener('click', () => {
                            const isSelected = row.classList.contains('selected-row');
                            document.querySelectorAll('.selected-row').forEach(r => r.classList.remove('selected-row'));
                            if (!isSelected) {
                                row.classList.add('selected-row');
                            }
                        });

                        row.appendChild(createPlayAllCell(verb));
                        row.appendChild(createTableCell(verb.infinitive));
                        row.appendChild(createTableCell(verb.pastSimple));
                        row.appendChild(createTableCell(verb.pastParticiple));
                        row.appendChild(createTableCell(verb.presentParticiple));
                        row.appendChild(createTableCell(verb.translation));
                        tbody.appendChild(row);
                    });
                    table.appendChild(tbody);
                    tableContainer.appendChild(table);
                    section.appendChild(tableContainer);
                    verbTablesContainer.appendChild(section);
                });
            } catch (err) {
                alert("è¡¨æ ¼æ¸²æŸ“å¤±æ•—: " + err.message);
            }
        }
        
        function renderCategorySelector() {
            categorySelectorEl.innerHTML = '';
            verbData.forEach((group, index) => {
                const container = document.createElement('label');
                container.className = 'category-label flex items-center gap-3 p-3 bg-white rounded-xl border-2 border-slate-200 cursor-pointer transition-all hover:border-blue-400 active:scale-95 active'; 
                
                const input = document.createElement('input');
                input.type = 'checkbox';
                input.id = `category-${index}`;
                input.value = index;
                input.checked = true;
                input.className = 'w-5 h-5 md:w-6 md:h-6 text-blue-600 rounded focus:ring-blue-500 border-gray-300 transition-all'; 
                
                input.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        container.classList.add('active');
                    } else {
                        container.classList.remove('active');
                    }
                });
                
                const text = document.createElement('span');
                text.className = 'text-slate-700 font-bold text-sm md:text-base select-none flex-1';
                text.textContent = group.title.split(' ')[1];

                container.appendChild(input);
                container.appendChild(text);
                categorySelectorEl.appendChild(container);
            });
        }
        
        function updateScoreboard() {
            scoreEl.textContent = score;
            streakEl.textContent = streak;
            localStreakEl.innerHTML = `ğŸ”¥ x${streak}`;
            scoreEl.parentElement.classList.add('scale-110');
            setTimeout(() => scoreEl.parentElement.classList.remove('scale-110'), 150);
        }

        function startGame() {
            const selectedCategories = Array.from(document.querySelectorAll('#category-selector input:checked'));
            if (selectedCategories.length === 0) {
                alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹ç¯„åœå–”ï¼ğŸ˜…");
                return;
            }
            quizLobby.classList.add('hidden-section');
            quizInterface.classList.remove('hidden-section');
            score = 0;
            streak = 0;
            updateScoreboard();
            generateQuestion();
        }

        function returnToLobby() {
            quizInterface.classList.add('hidden-section');
            quizLobby.classList.remove('hidden-section');
        }

        function generateQuestion() {
            const selectedCategories = Array.from(document.querySelectorAll('#category-selector input:checked')).map(input => parseInt(input.value));
            const quizPool = verbData
                .filter((group, index) => selectedCategories.includes(index))
                .flatMap(group => group.verbs);

            if (quizPool.length === 0) return;

            const randomVerb = quizPool[Math.floor(Math.random() * quizPool.length)];
            const types = ['pastSimple', 'pastParticiple', 'presentParticiple'];
            const questionType = types[Math.floor(Math.random() * types.length)];
            
            let typeText = '';
            let typeColorClass = '';
            
            if (questionType === 'pastSimple') {
                typeText = 'éå»å¼';
                typeColorClass = 'text-yellow-300';
            } else if (questionType === 'pastParticiple') {
                typeText = 'éå»åˆ†è©';
                typeColorClass = 'text-green-300';
            } else {
                typeText = 'V-ing';
                typeColorClass = 'text-pink-300';
            }
            
            currentQuestion = {
                verb: randomVerb,
                type: questionType,
                answer: randomVerb[questionType]
            };

            questionText.innerHTML = `
                <div class="text-xs md:text-sm uppercase tracking-widest opacity-70 mb-2">Quiz Time</div>
                <span class="text-4xl md:text-6xl font-black block mb-4 filter drop-shadow-lg">${randomVerb.infinitive}</span>
                <div class="text-lg md:text-xl font-medium opacity-90">
                    è«‹è¼¸å…¥ <span class="${typeColorClass} font-bold underline decoration-wavy underline-offset-4">${typeText}</span>
                </div>
            `;
            
            speak(currentQuestion.answer.replace('/', ' or '));
            
            answerInput.value = '';
            answerInput.disabled = false;
            answerInput.focus();
            answerInput.parentElement.classList.remove('opacity-50'); 
            
            submitBtn.classList.remove('hidden-section');
            nextActionContainer.classList.add('hidden-section');
            
            feedbackContainer.innerHTML = '';
            feedbackContainer.className = 'mt-4 h-12 md:h-16 flex items-center justify-center text-lg md:text-2xl font-bold transition-all opacity-0 px-2 text-center';
            
            isQuestionAnswered = false;
        }

        function checkAnswer() {
            if (!currentQuestion) return;

            const userAnswer = answerInput.value.trim().toLowerCase();
            const correctAnswer = currentQuestion.answer.toLowerCase();

            feedbackContainer.classList.remove('opacity-0');

            if (userAnswer === '') {
                feedbackContainer.innerHTML = '<span class="text-amber-500 animate-pulse">âš¡ è«‹è¼¸å…¥ç­”æ¡ˆï¼</span>';
                return;
            }

            const answerSpeech = currentQuestion.answer.replace('/', ' or ');

            if (userAnswer === correctAnswer) {
                feedbackContainer.innerHTML = `
                    <div class="flex items-center gap-2 text-emerald-500 bounce-in justify-center">
                        <span class="text-2xl md:text-3xl">ğŸ‰</span> 
                        <span>Correct! ${currentQuestion.answer}</span>
                    </div>`;
                score += 10;
                streak++;
                speak(['Correct', answerSpeech]);
            } else {
                feedbackContainer.innerHTML = `
                    <div class="flex items-center gap-2 text-rose-500 bounce-in justify-center">
                        <span class="text-2xl md:text-3xl">ğŸ’¥</span>
                        <span>Wrong. It's ${currentQuestion.answer}</span>
                    </div>`;
                streak = 0;
                speak(['Incorrect', answerSpeech]);
            }
            
            updateScoreboard();
            
            answerInput.disabled = true;
            answerInput.parentElement.classList.add('opacity-50'); 
            
            submitBtn.classList.add('hidden-section');
            nextActionContainer.classList.remove('hidden-section');
            setTimeout(() => nextQuestionBtn.focus(), 50);
            
            isQuestionAnswered = true;
        }

        function switchTab(mode) {
            if (mode === 'study') {
                studyView.classList.remove('hidden-section');
                quizView.classList.add('hidden-section');
                
                tabStudy.classList.remove('text-slate-500', 'hover:bg-slate-100');
                tabStudy.classList.add('bg-gradient-to-r', 'from-violet-500', 'to-fuchsia-500', 'text-white', 'shadow-md', 'scale-100', 'md:scale-105');
                
                tabQuiz.classList.remove('bg-gradient-to-r', 'from-violet-500', 'to-fuchsia-500', 'text-white', 'shadow-md', 'scale-100', 'md:scale-105');
                tabQuiz.classList.add('text-slate-500', 'hover:bg-slate-100');
            } else {
                studyView.classList.add('hidden-section');
                quizView.classList.remove('hidden-section');
                
                tabQuiz.classList.remove('text-slate-500', 'hover:bg-slate-100');
                tabQuiz.classList.add('bg-gradient-to-r', 'from-violet-500', 'to-fuchsia-500', 'text-white', 'shadow-md', 'scale-100', 'md:scale-105');
                
                tabStudy.classList.remove('bg-gradient-to-r', 'from-violet-500', 'to-fuchsia-500', 'text-white', 'shadow-md', 'scale-100', 'md:scale-105');
                tabStudy.classList.add('text-slate-500', 'hover:bg-slate-100');
            }
        }

        tabStudy.addEventListener('click', () => switchTab('study'));
        tabQuiz.addEventListener('click', () => switchTab('quiz'));
        
        startGameBtn.addEventListener('click', startGame);
        backToLobbyBtn.addEventListener('click', returnToLobby);
        nextQuestionBtn.addEventListener('click', generateQuestion);
        submitBtn.addEventListener('click', checkAnswer);

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && !quizView.classList.contains('hidden-section') && !quizInterface.classList.contains('hidden-section')) {
                if (isQuestionAnswered) {
                    generateQuestion();
                } else {
                    checkAnswer();
                }
            }
        });
        
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }
        
        // ä½¿ç”¨ window.onload ç¢ºä¿æ‰‹æ©Ÿå®Œå…¨è¼‰å…¥å¾Œæ‰åŸ·è¡Œï¼Œé¿å…å¡ç©ºç™½
        window.addEventListener('load', () => {
            try {
                renderTables();
                renderCategorySelector();
                updateScoreboard();
                switchTab('study');
                setTimeout(loadVoices, 1000); // å»¶å¾Œè¼‰å…¥èªéŸ³
            } catch(e) {
                alert("åˆå§‹åŒ–å¤±æ•—ï¼š" + e.message);
            }
        });

    </script>
</body>
</html>
